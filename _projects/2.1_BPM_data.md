---
title: 2.1 BPM Data
parent: 2. Linear Optics Measurements
nav_order: 1
layout: default
---

# BPM data

During stable operations in a storage ring/synchrotron, the beam is maintained on a closed orbit using feedback systems. The BPM data reflects this by showing a stable DC (average) position around zero (beam centroid) and stays within the noise range of the system. The noise is typically on the order of micrometers, and is caused by various environmental and machine-related errors. 

When the beam is kicked using a fast kicker ($$\delta p_x$$ and $$\delta p_y$$), the beam undergoes transverse, betatron oscillations. The beam is momentarily displaced from the orbit. The beam centroid naturally decays due to radiation damping and decoherence. During this process, the average position of the beam tends towards zero. Meanwhile the beam's emittance increases until it reaches an equilibrium.

Below is an interactive animation of this process happening for one dimension in, say, an ideal storage ring. On the left is a gaussian beam with a kicked by $$\delta p = 0.2$$ units. The working point was set to $$\nu_0 = 0.31$$ and the tune spread was set to $$\sigma_{\nu} = 0.0025$$. Each particle moves around the origin according to its own individual tune (in real life, this also changes with time, causing chaos). The tune spread (caused by many factors) is what causes this decoherence of the beam centroid in the animation. The beam centroid is plotted in red dots in both plots, and is what creates the turn-by-turn (TBT) data on the right.

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BPM Decoherence Demo</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 16px; }
    .row { display: flex; gap: 16px; flex-wrap: wrap; align-items: flex-start; }
    .panel { border: 1px solid #ddd; border-radius: 10px; padding: 12px; }
    .controls { display: grid; grid-template-columns: 140px 1fr 90px; gap: 8px 12px; align-items: center; }
    canvas { background: #fff; border: 1px solid #eee; border-radius: 10px; }
    .btns { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 10px; }
    button { padding: 8px 12px; border-radius: 10px; border: 1px solid #ccc; background: #f8f8f8; cursor: pointer; }
    button:hover { background: #f0f0f0; }
    .small { color: #555; font-size: 12px; margin-top: 6px; }
    .title { font-weight: 700; margin-bottom: 10px; }
  </style>
</head>
<body>

  <div class="title">Phase Space Decoherence</div>
  <div class="row">
    <div class="panel">
      <div class="btns">
        <button id="playPauseBtn">Play</button>
        <button id="stepBtn">Step</button>
        <button id="resetBtn">Reset</button>
      </div>
      <div class="controls">
        <label for="Q0">\(Q_0\) (mean tune)</label>
        <input id="Q0" type="range" min="0.05" max="0.95" step="0.001" value="0.31" />
        <div><span id="Q0Val">0.310</span></div>
        <label for="sigmaQ">\(\sigma_Q\) (tune spread)</label>
        <input id="sigmaQ" type="range" min="0.001" max="0.0100" step="0.0001" value="0.0025" />
        <div><span id="sigmaQVal">0.0025</span></div>
        <label for="kick">kick (\(p_0\) offset)</label>
        <input id="kick" type="range" min="-0.30" max="0.30" step="0.001" value="0.2" />
        <div><span id="kickVal">0.200</span></div>
      </div>
      <div class="small">
        Left canvas: (q, p) phase space. Right canvas: q centroid vs turn.<br/>
        (\(N_{particle}=5000, \beta=1, \alpha=0, \epsilon=0.005, N_{turn}=200\))
      </div>
    </div>
    <div class="panel">
      <div style="display:flex; gap:12px; flex-wrap:wrap;">
        <div>
          <div style="font-weight:600; margin-bottom:6px;">Phase Space</div>
          <canvas id="phaseCanvas" width="250" height="250"></canvas>
        </div>
        <div>
          <div style="font-weight:600; margin-bottom:6px;">BPM Centroid</div>
          <canvas id="bpmCanvas" width="400" height="250"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Load your separate JS file -->
  <script src="/assets/js/2_linear_optics_measurements/decoherence.js"></script>
</body>


The BPM data can be approximated from the paper [Decoherence Of Kicked Beams](https://lss.fnal.gov/archive/other/ssc/ssc-n-360.pdf) as a decaying sinusoid. Their final model incorporates two types of decoherence: decoherence from chromatic and nonlinear effects. We simplify their model a bit further to decrease the number of parameters that we have to work with:

$$x(N) = A\exp(-b N^2)\sin(2 \pi \nu N + \phi)$$

Where $$x(N)$$ is the position of the beam centroid as a function of turn number $$N$$, $$A$$ is the "position amplitude" of the kick, $$b$$ is the decoherence factor, $$\nu$$ is the tune and $$\phi$$ is the phase offset. This approximation assumes no synchrotron radiation and other collective effects and only includes decoherence from chromatic effects. Therefore, a small angle approximation with respect to N was used. At RHIC, the synchrotron tune is much less than the betatron tunes, so only $$N = 200$$ is usually used for measurements. A plot of the fit in orange using the equation above is shown below:

<figure>
  <img src="/assets/images/2_linear_optics_measurements/TBT_Fit.png" alt="TBT_fit" width="400">
  <figcaption><strong>Figure 1.</strong> Fitting \(x(N)\) to the TBT data from the animation. The exponential curves are also drawn to show the shape of the data.</figcaption>
</figure>

The black curves are plotted using the resulting parameters $$A, b$$ on the exponential portion of $$x(n)$$:

$$x(N) = A\exp(-b N^2)$$

AC Dipoles were also used in RHIC in part to help with optics measurements. This was done by applying a sinusoidal (AC), oscillating magnetic field close to the working point, inducing coherent betatron oscillations into the beam. This allowed the BPM data to be approximated as just a sinusoidal function. 

Realistically, aside from other causes of decoherence and tune shift, there are also BPM errors to take into account.

# BPM Errors

Systematic errors from BPMs (physical errors of BPMs) come from a couple main sources: misalignment, tilt, gain/callibration, and coupling. Since these are systematic, they can be written in the following form:

$$ \begin{pmatrix} \bar{x} \\ \bar{y} \end{pmatrix} = \frac{1}{\sqrt{1 - C^2}}
   \begin{pmatrix} \cos{\theta} && \sin{\theta} \\ 
                  -\sin{\theta} && \cos{\theta} \end{pmatrix}
   \begin{pmatrix} 1 && C \\ 
                   C && 1 \end{pmatrix}
   \begin{pmatrix} g_x && 0 \\ 
                   0 && g_y \end{pmatrix}
   \begin{pmatrix} x \\ y \end{pmatrix}
$$

- $$x, y$$: Data without BPM errors
- $$\bar{x}, \bar{y}$$: Data with BPM errors
- $$g_x, g_y$$: Gain/Callibration
- $$C$$: Coupling
- $$\theta$$: Roll

Source: [J. Safranek, ‘Experimental determination of storage ring optics using orbit response measurements’, Nucl. Inst. And Meth. A388, 27 (1997)](https://www.sciencedirect.com/science/article/pii/S0168900297003094)

The remaining sources of errors usually stem from a multitude of causes such as vibrations and temperature. These errors are usualy random, and by the central limit theorem, they are usually taken to be gaussian. Many sources for RHIC deem random errors to be on the order of 5-30 $$\mu m$$ depending where the BPM is around the ring.

Below is an interactive plot of the same BPM simulated data as before, but with a vertical axis as before (right column). The decoherence usually is very similar between bpms and axis, and the phase is usually random so those are set. However, the user is able to change the tune offset and amplitudes of the beams. They are able to play around with the various types of BPM errors to get a feel for how BPM error influence BPM data. The top plots show the BPM data without (black) and with (red) noise, and the bottom plots show the difference between the two curves.

<hr>

<script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>

<script src="/assets/js/2_linear_optics_measurements/BPM_error.js"></script>

<div id="BPMError-plot" style="width: 100%; height: 600px;"></div>
<!-- 
<link rel="stylesheet" href="{{ '/assets/css/custom.scss' | relative_url }}"> -->

<div class="bpm-controls-container">
  <!-- LEFT COLUMN -->
  <div class="control-column">
    <div class="control-row">
        <label>
            \( x \) Amplitude [mm]:
            <input id="Ampx-input" type="range" min="-1.0" max="1.0" step="0.01" value="-0.3">
            <span id="Ampx-value">-0.3</span>
        </label>
    </div>
    <div class="control-row">
        <label>
            \( y \) Amplitude [mm]:
            <input id="Ampy-input" type="range" min="-1.0" max="1.0" step="0.01" value="-0.3">
            <span id="Ampy-value">-0.3</span>
        </label>
    </div>
    <div class="control-row">
        <label>
            (\( \Delta \nu_x \)):
            <input id="dnux-input" type="range" min="-0.01" max="0.01" step="0.001" value="0.000">
            <span id="dnux-value">0.000</span>
        </label>
    </div>
    <div class="control-row">
        <label>
            (\( \Delta \nu_y \)):
            <input id="dnuy-input" type="range" min="-0.01" max="0.01" step="0.001" value="0.000">
            <span id="dnuy-value">0.000</span>
        </label>
    </div>
  </div>

  <!-- RIGHT COLUMN -->
  <div class="control-column">
    <div class="control-row">
        <label>
            BPM Tilt (\( \theta \)) [mrad]:
            <input id="tilt-input" type="range" min="-1.0" max="1.0" step="0.001" value="0.000">
            <span id="tilt-value">0.000</span>
        </label>
    </div>
    <div class="control-row">
        <label>
            Coupling (\( C \)):
            <input id="coup-input" type="range" min="-1.0" max="1.0" step="0.001" value="0.000">
            <span id="coup-value">0.000</span>
        </label>
    </div>
    <div class="control-row">
        <label>
            Gain change x (\( \Delta g_x \)):
            <input id="gx-input" type="range" min="-1.0" max="1.0" step="0.001" value="0.000">
            <span id="gx-value">0.000</span>
        </label>
    </div>
    <div class="control-row">
        <label>
            Gain change y (\(\Delta g_y \)):
            <input id="gy-input" type="range" min="-1.0" max="1.0" step="0.001" value="0.000">
            <span id="gy-value">0.000</span>
        </label>
    </div>
    <div class="control-row">
        <label>
            \( \sigma_x \) [mm]:
            <input id="sx-input" type="range" min="0.0" max="0.1" step="0.001" value="0.000">
            <span id="sx-value">0.000</span>
        </label>
    </div>
    <div class="control-row">
        <label>
            \( \sigma_y \) [mm]:
            <input id="sy-input" type="range" min="0.0" max="0.1" step="0.001" value="0.000">
            <span id="sy-value">0.000</span>
        </label>
    </div>
    <button id="reset-button" style="margin-top: 10px;">
    RESET
    </button>
    <button id="resample-button" style="margin-top: 10px; margin-left: 8px;">
    RESAMPLE NOISE
    </button>
  </div>
</div>

<hr />
